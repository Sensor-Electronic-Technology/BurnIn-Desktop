@using BurnInControl.Data.BurnInTests.Wafers
@using BurnInControl.Data.StationModel.Components
@using BurnInControl.Infrastructure.QuickTest
@using BurnInControl.UI.Components.App_Components.Controls.WaferMap
@using BurnInControl.UI.Components.App_Components.Dialogs
@using QuickTest.Data.DataTransfer
@inject DialogService DialogService
@inject QuickTestDataService QuickTestDataService

<RadzenStack Orientation="Orientation.Vertical">
    <RadzenTabs RenderMode="TabRenderMode.Client">
        <Tabs>
            <RadzenTabsItem Text="Left Pocket(P1)">
                <PocketSetup PocketCaption="Left Pocket(P1)"
                             @bind-WaferSetup="@this._pocket1Setup"
                             WaferList="@this._waferList"/>
            </RadzenTabsItem>
            <RadzenTabsItem Text="Middle Pocket(P2)">
                <PocketSetup PocketCaption="Middle Pocket(P2)"
                             @bind-WaferSetup="@this._pocket2Setup"
                             WaferList="@this._waferList"/>
            </RadzenTabsItem>
            <RadzenTabsItem Text="Right Pocket(P3)">
                <PocketSetup PocketCaption="Right Pocket(P3)"
                             @bind-WaferSetup="@this._pocket3Setup"
                             WaferList="@this._waferList"/>
            </RadzenTabsItem>
        </Tabs>
    </RadzenTabs>
    <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center"
                 JustifyContent="JustifyContent.Center">
        <RadzenButton Text="Save" Size="ButtonSize.Large"
                      Click="@this.SaveHandler"
                      ButtonStyle="ButtonStyle.Secondary"
                      Icon="save" Style="width: 170px"/>
        <RadzenButton Text="Cancel/Clear"
                      ButtonStyle="ButtonStyle.Danger"
                      Size="ButtonSize.Large" Icon="cancel"
                      Click="@this.Cancel"
                      IsBusy="false"
                      Shade="Shade.Default"
                      Disabled="false"/>
    </RadzenStack>
</RadzenStack>
@code {
    [Parameter] public EventCallback<List<WaferSetup>> Save { get; set; }
    [Parameter] public IEnumerable<Pad>? Map { get; set; } = Enumerable.Empty<Pad>();
    private IEnumerable<string> _waferList=Enumerable.Empty<string>();

    WaferSetup _pocket1Setup = new WaferSetup() {
        WaferId = "W01",
        BurnNumber = 1,
        StationPocket = StationPocket.LeftPocket,
        Probe1=StationProbe.Probe1,
        Probe2=StationProbe.Probe2
    };
    
    WaferSetup _pocket2Setup = new WaferSetup() {
        WaferId = "W02",
        BurnNumber = 1,
        StationPocket = StationPocket.MiddlePocket,
        Probe1=StationProbe.Probe3,
        Probe2=StationProbe.Probe4
    };
    
    WaferSetup _pocket3Setup = new WaferSetup() {
        WaferId = "W03",
        BurnNumber = 1,
        StationPocket = StationPocket.RightPocket,
        Probe1=StationProbe.Probe5,
        Probe2=StationProbe.Probe6
    };


    protected override async Task OnInitializedAsync() {
        this.Map = await this.QuickTestDataService.GetWaferMap(2);
        this._waferList = await this.QuickTestDataService.GetQuickTestList(new DateTime(2024,1,1));
    }

    private Task SaveHandler() {
        return this.Save.InvokeAsync(new List<WaferSetup>() {
            _pocket1Setup,
            _pocket2Setup,
            _pocket3Setup
        });
    }
    
    private Task Cancel() {
        return Task.CompletedTask;
    }
    
    
}